<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>🐞Beetle Debug</title>
    <link rel="stylesheet" href="src/style.css">    
  </head>

  <body>
    <!-- <div id="app"></div> -->
     <h1>🐞Beetle Debug</h1>

   
     <!-- <div class="container" id="container1">
       <div class="item" draggable="true" id="item-1">Item 1</div>
       <div class="item" draggable="true" id="item-2">Item 2</div>
       <div class="item" draggable="true" id="item-3">Item 3</div>
     </div>
     <div class="container" id="container2">
      <div class="item" draggable="true" id="item-4">Item 1</div>
      <div class="item" draggable="true" id="item-5">Item 2</div>
      <div class="item" draggable="true" id="item-6">Item 3</div>
    </div>
   
     <div id="outside-area"></div> -->


     <h1>Drag-and-Drop with Copy and Move</h1>
     <p>Drag items from the green container to create copies in the red sockets. Items in the red sockets can be moved between them.</p>
   
     <!-- n-container (original container) -->
      <div class="n-container">
       <div class="item" draggable="true" id="item-1">Item 1</div>
       <div class="item" draggable="true" id="item-2">Item 2</div>
       <div class="item" draggable="true" id="item-3">Item 3</div>
      </div>
      
      <!-- n-container-sockets -->
      <div class="n-container-socket" data-max-items="3"></div>
     <div class="n-container-socket" data-max-items="2"></div>
  

  <script>
    const items = document.querySelectorAll('.item');
    const sockets = document.querySelectorAll('.n-container-socket');

    // Allow dragging of items in n-container
    items.forEach(item => {
      item.addEventListener('dragstart', (e) => {
        e.dataTransfer.setData('text/plain', e.target.id); // Store the item's ID
        e.dataTransfer.setData('source', 'n-container'); // Identify source container
      });
    });

    sockets.forEach(socket => {
      // Allow dragover to enable dropping
      socket.addEventListener('dragover', (e) => {
        e.preventDefault();

        const maxItems = parseInt(socket.getAttribute('data-max-items'), 10);
        const currentItems = socket.querySelectorAll('.item').length;

        // Highlight socket if full
        if (currentItems >= maxItems) {
          socket.classList.add('socket-full');
        } else {
          socket.classList.remove('socket-full');
        }
      });

      // Handle the drop event
      socket.addEventListener('drop', (e) => {
        e.preventDefault();

        const maxItems = parseInt(socket.getAttribute('data-max-items'), 10);
        const currentItems = socket.querySelectorAll('.item').length;

        // Prevent drop if socket is full
        if (currentItems >= maxItems) {
          // alert('This socket is full.');
          return;
        }

        const itemId = e.dataTransfer.getData('text/plain'); // Get the dragged item ID
        const source = e.dataTransfer.getData('source'); // Get the source of the dragged item
        const originalItemId = itemId.replace(/-copy-\d+$/, ''); // Extract the original item ID (for duplicates check)

        // Prevent duplicates in the same socket
        const isDuplicate = Array.from(socket.querySelectorAll('.item')).some(
          item => item.id.startsWith(originalItemId)
        );

        if (isDuplicate) {
          // alert('This item already exists in this socket.');
          return;
        }

        if (source === 'n-container') {
          // Create a copy of the item if dragged from n-container
          const originalItem = document.getElementById(itemId);
          if (originalItem) {
            const newItem = originalItem.cloneNode(true);
            newItem.id = `${itemId}-copy-${Date.now()}`; // Assign unique ID to copied item
            newItem.draggable = true; // Make the new item draggable
            addDragListeners(newItem); // Add drag listeners to the new item
            socket.appendChild(newItem); // Add to the socket
          }
        } else if (source === 'n-container-socket') {
          // Move the item between sockets
          const draggedItem = document.getElementById(itemId);
          if (draggedItem) {
            socket.appendChild(draggedItem);
          }
        }
      });
    });

    // Add dragend listener to delete items dropped outside sockets
    document.addEventListener('dragend', (e) => {
      const itemId = e.target.id;
      const draggedItem = document.getElementById(itemId);

      if (!draggedItem) return;

      // Check if the dragged item was dropped inside any socket
      const isDroppedInSocket = Array.from(sockets).some(socket => {
        const rect = socket.getBoundingClientRect();
        return (
          e.clientX >= rect.left &&
          e.clientX <= rect.right &&
          e.clientY >= rect.top &&
          e.clientY <= rect.bottom
        );
      });

      // Delete the item if dropped outside all sockets
      if (!isDroppedInSocket && e.dataTransfer.getData('source') === 'n-container-socket') {
        draggedItem.remove();
        console.log(`Item ${itemId} deleted because it was dropped outside a socket.`);
      }
    });

    // Add drag listeners to dynamically created items
    function addDragListeners(item) {
      item.addEventListener('dragstart', (e) => {
        e.dataTransfer.setData('text/plain', e.target.id); // Store the item's ID
        e.dataTransfer.setData('source', 'n-container-socket'); // Identify source container
      });
    }






    // // Allow dragging of items in n-container
    // const items = document.querySelectorAll('.item');
    // items.forEach(item => {
    //   item.addEventListener('dragstart', (e) => {
    //     e.dataTransfer.setData('text/plain', e.target.id); // Store the item's ID
    //   });
    // });

    // // Enable drop functionality for n-container-socket
    // const sockets = document.querySelectorAll('.n-container-socket');
    // sockets.forEach(socket => {
    //   // Allow dragover to enable dropping
    //   socket.addEventListener('dragover', (e) => {
    //     e.preventDefault(); // Required for drop to work
    //   });

    //   // Handle the drop event
    //   socket.addEventListener('drop', (e) => {
    //     e.preventDefault();
    //     const itemId = e.dataTransfer.getData('text/plain'); // Get the ID of the dragged item
    //     const originalItem = document.getElementById(itemId);

    //     if (originalItem) {
    //       // Create a copy of the item
    //       const newItem = originalItem.cloneNode(true);
    //       newItem.id = `${itemId}-copy-${Date.now()}`; // Assign a unique ID to the copied item
    //       socket.appendChild(newItem); // Add the copy to the socket
    //     }
    //   });
    // });


  //   // const container = document.getElementById('container');
  //   const items = document.querySelectorAll('.item');

  // // delete on spill 
  //   items.forEach(item => {
  //     const parentContainer = item.parentElement;

  //     item.addEventListener('dragstart', (e) => {
  //       e.dataTransfer.setData('text/plain', e.target.id);
  //       e.target.classList.add('dragging');
  //     });

  //     item.addEventListener('dragend', (e) => {

  //       const rect = parentContainer.getBoundingClientRect();
  //       const x = e.clientX;
  //       const y = e.clientY;

  //       // Check if the drop is outside the container
  //       if (
  //         x < rect.left || 
  //         x > rect.right || 
  //         y < rect.top || 
  //         y > rect.bottom
  //       ) {
  //         const itemId = e.dataTransfer.getData('text/plain');
  //         const element = document.getElementById(itemId);
  //         element.remove(); // Remove the item from the DOM
  //       }
  //     });


  //   });
  </script>

    <!-- <script type="module" src="/src/main.js"></script> -->
  </body>
</html>
